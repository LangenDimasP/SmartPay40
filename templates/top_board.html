{% extends 'base_siswa.html' %}

{% block title %}Top Board - Kantin Sekolah{% endblock %}

{% block content %}
<style>
    /* Animations and custom styles not supported by Tailwind */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    @keyframes slideIn {
        0% { transform: translateX(100%); opacity: 0; }
        100% { transform: translateX(0); opacity: 1; }
    }

    .title-gradient {
        background: linear-gradient(90deg, #7c4dff, #5e35b1);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 4px 12px rgba(124, 77, 255, 0.2);
    }

    .table-row:nth-child(1) { background-color: rgba(124, 77, 255, 0.1); }
    .table-row:nth-child(2) { background-color: rgba(124, 77, 255, 0.05); }
    .table-row:nth-child(3) { background-color: rgba(124, 77, 255, 0.03); }
</style>

<div class="font-['Inter',-apple-system,BlinkMacSystemFont,sans-serif]">
    <nav class="top-board-header bg-gradient-to-br from-[#7c4dff] to-[#5e35b1] text-white p-[30px_25px] flex items-center shadow-[0_4px_20px_rgba(0,0,0,0.08)] rounded-b-[40px] sticky top-0 z-[1000]">
        <a href="{{ url_for('dashboard') }}" class="text-white text-xl font-bold flex items-center no-underline">
            <i class="fas fa-trophy mr-2"></i>
            <span>Top Board</span>
        </a>
    </nav>

    <div class="container mx-auto p-4">
        <div class="card bg-white p-6 mb-8 rounded-[15px] shadow-[0_10px_15px_-3px_rgba(124,77,255,0.1),0_4px_6px_-2px_rgba(124,77,255,0.05)] hover:-translate-y-[5px] transition-transform duration-300">
            <h1 class="text-4xl font-bold text-center mb-2 title-gradient">
                <i class="fas fa-crown mr-2"></i>Top Board
            </h1>
            <h2 class="text-2xl font-semibold text-center mb-6 text-[#666]">Peringkat Pembelanja Harian</h2>
            <p class="text-center text-[#666] mb-6 flex justify-center items-center">
                <i class="far fa-calendar-alt mr-2 text-[#7c4dff]"></i>
                <span>Tanggal: {{ date_str }}</span>
            </p>

            {% if leaderboard %}
                <div class="overflow-x-auto">
<table class="min-w-full bg-white rounded-lg overflow-hidden">
    <thead>
        <tr class="table-header bg-gradient-to-br from-[#7c4dff] to-[#5e35b1] text-white">
            <th class="py-4 px-6 text-left rounded-tl-lg">Peringkat</th>
            <th class="py-4 px-6 text-left">Nama</th>
            <th class="py-4 px-6 text-left">Kelas</th>
            <th class="py-4 px-6 text-left">Jurusan</th>
            <th class="py-4 px-6 text-left rounded-tr-lg">Total Belanja</th>
        </tr>
    </thead>
    <tbody>
        {% for entry in leaderboard %}
            {% if entry.rank <= 10 %}
            <tr class="table-row border-b hover:bg-[#ede7f6] transition-colors duration-150">
                <td class="py-4 px-6 font-bold">
                    {% if entry.rank == 1 %}
                        <span class="gold flex items-center text-[#FFD700] [text-shadow:0_0_5px_rgba(255,215,0,0.5)]">
                            <i class="fas fa-medal text-2xl mr-2" style="color:#FFD700"></i> {{ entry.rank }}
                        </span>
                    {% elif entry.rank == 2 %}
                        <span class="silver flex items-center text-[#C0C0C0] [text-shadow:0_0_5px_rgba(192,192,192,0.5)]">
                            <i class="fas fa-medal text-2xl mr-2" style="color:#C0C0C0"></i> {{ entry.rank }}
                        </span>
                    {% elif entry.rank == 3 %}
                        <span class="bronze flex items-center text-[#CD7F32] [text-shadow:0_0_5px_rgba(205,127,50,0.5)]">
                            <i class="fas fa-medal text-2xl mr-2" style="color:#CD7F32"></i> {{ entry.rank }}
                        </span>
                    {% else %}
                        <span class="flex items-center pl-2">
                            <span class="text-[#7c4dff] mr-2">#</span>{{ entry.rank }}
                        </span>
                    {% endif %}
                </td>
                <td class="py-4 px-6 font-medium flex items-center gap-3">
                    <div class="relative w-10 h-10 flex items-center justify-center">
                        <img src="{{ url_for('static', filename='profile_pics/' + entry.profile_pic_filename) }}"
                             alt="Foto Profil {{ entry.username }}"
                             class="absolute left-1/2 top-1/2 w-8 h-8 -translate-x-1/2 -translate-y-1/2 rounded-full object-cover bg-white z-10">
                        {% if entry.active_border %}
                        <div class="absolute inset-0 rounded-full pointer-events-none z-20"
                             style="border: 4px solid transparent; border-image: url('{{ url_for('static', filename=entry.active_border.image_path) }}') 100 fill stretch; box-sizing: border-box;">
                        </div>
                        {% endif %}
                    </div>
                    <span>{{ entry.username }}</span>
                </td>
                <td class="py-4 px-6">{{ entry.kelas }}</td>
                <td class="py-4 px-6">{{ entry.jurusan }}</td>
                <td class="py-4 px-6 font-semibold text-[#7c4dff]">{{ entry.total_spent }}</td>
            </tr>
            {% endif %}
        {% endfor %}
    </tbody>
</table>
                </div>
            {% else %}
                <div class="text-center p-10 bg-[#ede7f6] rounded-lg">
                    <i class="fas fa-shopping-cart text-[#7c4dff]/50 text-5xl mb-4"></i>
                    <p class="text-lg text-[#666]">Belum ada transaksi hari ini. Ayo belanja di kantin!</p>
                </div>
            {% endif %}
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="fixed top-4 right-4 z-50">
                {% for category, message in messages %}
                    <div class="flash-message bg-{{ 'green-500' if category == 'success' else 'red-500' if category == 'danger' else 'yellow-500' }} text-white p-4 rounded-lg shadow-lg mb-2 flex items-center animate-[slideIn_0.5s_ease-out]">
                        <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-circle' if category == 'danger' else 'exclamation-triangle' }} mr-2"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const flashMessages = document.querySelectorAll('.flash-message');
        flashMessages.forEach(function(message) {
            setTimeout(function() {
                message.style.opacity = '0';
                message.style.transform = 'translateX(100%)';
                message.style.transition = 'all 0.5s ease-in-out';
                setTimeout(function() {
                    message.style.display = 'none';
                }, 500);
            }, 5000);
        });
    });
</script>
{% endblock %}