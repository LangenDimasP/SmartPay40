<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Admin Panel{% endblock %} - DimasCash</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="manifest"
      href="{{ url_for('static', filename='manifest.json') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/tailwind.output.css') }}"
    />
    <meta name="theme-color" content="#7c4dff" />
    <script
      src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"
      defer
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"
      defer
    ></script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("/static/service-worker.js")
            .then(function (reg) {
              console.log("ServiceWorker registered:", reg);
            })
            .catch(function (err) {
              console.log("ServiceWorker registration failed:", err);
            });
        });
      }
    </script>

    <!-- Custom styles for specific elements not covered by Tailwind -->
    <style>
      body {
        font-family: "Poppins", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .nav-icon {
        transition: background-color 0.2s ease, color 0.2s ease;
      }
      .nav-link {
        transition: background-color 0.2s ease, color 0.2s ease;
      }
      
      /* Overlay untuk mobile */
      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 40;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      
      .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      
      /* Sidebar animations */
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      /* Desktop sidebar selalu visible */
      @media (min-width: 1024px) {
        .sidebar {
          transform: translateX(0) !important;
        }
      }
      
      /* Hamburger menu animation */
      .hamburger {
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .hamburger.active .line1 {
        transform: rotate(-45deg) translate(-5px, 6px);
      }
      
      .hamburger.active .line2 {
        opacity: 0;
      }
      
      .hamburger.active .line3 {
        transform: rotate(45deg) translate(-5px, -6px);
      }
      
      .hamburger .line {
        width: 25px;
        height: 3px;
        background-color: #374151;
        margin: 3px 0;
        transition: 0.3s;
        display: block;
      }
    </style>
    {% block styles %}{% endblock %}
  </head>
  <body class="bg-gray-100 flex m-0 p-0 overflow-hidden">
    <!-- Mobile Header dengan Hamburger -->
    <header class="lg:hidden fixed top-0 left-0 right-0 bg-white shadow-lg z-50 px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <img
          src="{{ url_for('static', filename='images/hanya_logo.png') }}"
          alt="DimasCash Logo"
          class="h-8"
        />
        <span class="text-lg font-bold text-black tracking-wide">SmartPay</span>
      </div>
      
      <button id="hamburger" class="hamburger">
        <span class="line line1"></span>
        <span class="line line2"></span>
        <span class="line line3"></span>
      </button>
    </header>

    <!-- Overlay untuk mobile -->
    <div id="sidebar-overlay" class="sidebar-overlay lg:hidden"></div>

    <!-- Sidebar -->
    <aside
      id="sidebar"
      class="sidebar w-64 bg-white h-screen fixed left-0 top-0 px-4 py-5 shadow-xl flex flex-col z-50 overflow-y-auto lg:translate-x-0 lg:static"
    >
      <!-- Logo Area - Hidden di mobile karena sudah ada di header -->
      <div
        title="beranda"
        class="text-left mb-2.5 pb-5 border-b border-gray-200 mx-auto hidden lg:block"
      >
        <a
          href="{{ url_for('admin_dashboard_content') }}"
          class="flex items-center gap-1 no-underline"
        >
          <img
            src="{{ url_for('static', filename='images/hanya_logo.png') }}"
            alt="DimasCash Logo"
            class="max-h-14"
          />
          <span
            class="text-lg font-bold text-black tracking-wide"
            >SmartPay</span
          >
        </a>
      </div>

      <!-- Mobile spacing untuk header -->
      <div class="h-16 lg:hidden"></div>

      <!-- Main Navigation -->
      <nav>
        <ul class="list-none p-0 m-0">
          <li>
            <a
              title="Dashboard"
              href="{{ url_for('admin_dashboard_content') }}"
              class="nav-link flex items-center p-3 mb-1 rounded-lg no-underline text-gray-600 font-medium hover:bg-[#7c4dff] hover:text-white {% if active_page == 'admin_dashboard_content' %}bg-[#7c4dff] text-white{% endif %}"
            >
              <span
                class="nav-icon w-8 h-8 inline-flex justify-center items-center bg-purple-100 text-[#7c4dff] rounded-lg mr-4 text-sm hover:bg-white hover:text-[#7c4dff] {% if active_page == 'admin_dashboard_content' %}!bg-white !text-[#7c4dff]{% endif %}"
              >
                <i class="fas fa-tachometer-alt"></i>
              </span>
              <span class="flex-grow">Dashboard</span>
            </a>
          </li>
          <li>
            <a
              title="Users"
              href="{{ url_for('admin_users') }}"
              class="nav-link flex items-center p-3 mb-1 rounded-lg no-underline text-gray-600 font-medium hover:bg-[#7c4dff] hover:text-white {% if active_page == 'admin_users' %}bg-[#7c4dff] text-white{% endif %}"
            >
              <span
                class="nav-icon w-8 h-8 inline-flex justify-center items-center bg-purple-100 text-[#7c4dff] rounded-lg mr-4 text-sm hover:bg-white hover:text-[#7c4dff] {% if active_page == 'admin_users' %}!bg-white !text-[#7c4dff]{% endif %}"
              >
                <i class="fas fa-users"></i>
              </span>
              <span class="flex-grow">Pengguna</span>
            </a>
          </li>
          <li>
            <a
              title="Transactions"
              href="{{ url_for('admin_transactions') }}"
              class="nav-link flex items-center p-3 mb-1 rounded-lg no-underline text-gray-600 font-medium hover:bg-[#7c4dff] hover:text-white {% if active_page == 'admin_transactions' %}bg-[#7c4dff] text-white{% endif %}"
            >
              <span
                class="nav-icon w-8 h-8 inline-flex justify-center items-center bg-purple-100 text-[#7c4dff] rounded-lg mr-4 text-sm hover:bg-white hover:text-[#7c4dff] {% if active_page == 'admin_transactions' %}!bg-white !text-[#7c4dff]{% endif %}"
              >
                <i class="fas fa-exchange-alt"></i>
              </span>
              <span class="flex-grow">Transaksi</span>
            </a>
          </li>
          <li>
            <a
              title="Laporan"
              href="{{ url_for('admin_laporan') }}"
              class="nav-link flex items-center p-3 mb-1 rounded-lg no-underline text-gray-600 font-medium hover:bg-[#7c4dff] hover:text-white {% if active_page == 'admin_laporan' %}bg-[#7c4dff] text-white{% endif %}"
            >
              <span
                class="nav-icon w-8 h-8 inline-flex justify-center items-center bg-purple-100 text-[#7c4dff] rounded-lg mr-4 text-sm hover:bg-white hover:text-[#7c4dff] {% if active_page == 'admin_laporan' %}!bg-white !text-[#7c4dff]{% endif %}"
              >
                <i class="fas fa-file-alt"></i>
              </span>
              <span class="flex-grow">Laporan</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Section Title -->
      <div
        class="text-xs text-gray-400 uppercase my-2 mx-2 font-medium"
      >
        Admin Panel
      </div>

      <!-- Admin Navigation -->
      <nav>
        <ul class="list-none p-0 m-0">
          <li>
            <a
              title="Registration Account"
              href="{{ url_for('admin_register_user') }}"
              class="nav-link flex items-center p-3 mb-1 rounded-lg no-underline text-gray-600 font-medium hover:bg-[#7c4dff] hover:text-white {% if active_page == 'admin_register_user' %}bg-[#7c4dff] text-white{% endif %}"
            >
              <span
                class="nav-icon w-8 h-8 inline-flex justify-center items-center bg-purple-100 text-[#7c4dff] rounded-lg mr-4 text-sm hover:bg-white hover:text-[#7c4dff] {% if active_page == 'admin_register_user' %}!bg-white !text-[#7c4dff]{% endif %}"
              >
                <i class="fas fa-user-plus"></i>
              </span>
              <span class="flex-grow">Tambah Akun</span>
            </a>
          </li>
          <li>
            <a
              title="Topup Request"
              href="{{ url_for('admin_pending_topups') }}"
              class="nav-link flex items-center p-3 mb-1 rounded-lg no-underline text-gray-600 font-medium hover:bg-[#7c4dff] hover:text-white {% if active_page == 'admin_pending_topups' %}bg-[#7c4dff] text-white{% endif %}"
            >
              <span
                class="nav-icon w-8 h-8 inline-flex justify-center items-center bg-purple-100 text-[#7c4dff] rounded-lg mr-4 text-sm hover:bg-white hover:text-[#7c4dff] {% if active_page == 'admin_pending_topups' %}!bg-white !text-[#7c4dff]{% endif %}"
              >
                <i class="fas fa-inbox"></i>
              </span>
              <span class="flex-grow">Topup</span>
            </a>
          </li>
          <li>
            <a 
              href="{{ url_for('admin_margin') }}"
              class="nav-link flex items-center p-3 mb-1 rounded-lg no-underline text-gray-600 font-medium hover:bg-[#7c4dff] hover:text-white"
            >
              <span class="nav-icon w-8 h-8 inline-flex justify-center items-center bg-purple-100 text-[#7c4dff] rounded-lg mr-4 text-sm hover:bg-white hover:text-[#7c4dff]">
                <i class="fas fa-percent"></i>
              </span>
              <span class="flex-grow">Pengaturan Margin Penjual</span>
            </a>
          </li>
          <li>
            <a
              title="Profile"
              href="{{ url_for('admin_profile') }}"
              class="nav-link flex items-center p-3 mb-1 rounded-lg no-underline text-gray-600 font-medium hover:bg-[#7c4dff] hover:text-white {% if active_page == 'admin_profile' %}bg-[#7c4dff] text-white{% endif %}"
            >
              <span
                class="nav-icon w-8 h-8 inline-flex justify-center items-center bg-purple-100 text-[#7c4dff] rounded-lg mr-4 text-sm hover:bg-white hover:text-[#7c4dff] {% if active_page == 'admin_profile' %}!bg-white !text-[#7c4dff]{% endif %}"
              >
                <i class="fas fa-user-circle"></i>
              </span>
              <span class="flex-grow">Profil Admin</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Logout Link -->
      <div class="mt-auto pt-5 border-t border-gray-200">
        <a
          title="Logout"
          href="{{ url_for('logout') }}"
          class="flex items-center p-3 no-underline text-red-600 font-medium rounded-lg hover:bg-red-600 hover:text-white"
        >
          <span
            class="w-8 h-8 inline-flex justify-center items-center bg-red-100 text-red-600 rounded-lg mr-4 text-sm hover:bg-white hover:text-red-600"
          >
            <i class="fas fa-sign-out-alt"></i>
          </span>
          <span>Logout</span>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <div
      class="flex-1 p-4 pt-20 h-screen overflow-y-auto lg:ml-0 lg:pt-8"
    >
      {% block admin_content %}{% endblock %}
    </div>

    <!-- JavaScript untuk hamburger menu -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const hamburger = document.getElementById('hamburger');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        
        // Toggle sidebar
        function toggleSidebar() {
          hamburger.classList.toggle('active');
          sidebar.classList.toggle('active');
          overlay.classList.toggle('active');
          
          // Prevent body scroll when sidebar is open
          if (sidebar.classList.contains('active')) {
            document.body.style.overflow = 'hidden';
          } else {
            document.body.style.overflow = '';
          }
        }
        
        // Close sidebar
        function closeSidebar() {
          hamburger.classList.remove('active');
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          document.body.style.overflow = '';
        }
        
        // Event listeners
        hamburger.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', closeSidebar);
        
        // Close sidebar when clicking on nav links (mobile)
        const navLinks = sidebar.querySelectorAll('a');
        navLinks.forEach(link => {
          link.addEventListener('click', () => {
            if (window.innerWidth < 1024) {
              closeSidebar();
            }
          });
        });
        
        // Handle resize
        window.addEventListener('resize', () => {
          if (window.innerWidth >= 1024) {
            closeSidebar();
          }
        });
      });
    </script>
    
    {% block scripts %}{% endblock %}
  </body>
</html>